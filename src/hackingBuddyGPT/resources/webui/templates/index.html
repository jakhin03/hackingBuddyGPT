<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="stylesheet" href="/static/style.css" />
        <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        <script src="https://d3js.org/d3.v7.min.js"></script>
        <title>hackingBuddyGPT</title>
    </head>
    <body>
        <div class="app-container">
            <!-- Navigation Drawer -->
            <nav class="navigation-drawer" id="sidebar">
                <div class="nav-header">
                    <div class="nav-header-content">
                        <button class="nav-toggle tooltip" aria-label="Toggle navigation" data-tooltip="Toggle sidebar">
                            <span class="material-icons">menu</span>
                        </button>
                        <div class="nav-title">
                            <h1>hackingBuddyGPT</h1>
                            <span class="subtitle">AI Security Testing</span>
                        </div>
                    </div>
                    <div class="follow-runs-container">
                        <div class="checkbox-container">
                            <input type="checkbox" id="follow_new_runs" class="md-checkbox" />
                            <label for="follow_new_runs" class="checkbox-label">
                                <span class="material-icons checkbox-icon">check</span>
                                Follow new runs
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="nav-content">
                    <div class="section-header">
                        <span class="material-icons">history</span>
                        <h2>Recent Runs</h2>
                    </div>
                    <div class="run-list-container">
                        <ul id="run-list" class="run-list"></ul>
                    </div>
                    
                </div>
            </nav>

            <!-- Main Content -->
            <div class="main-content" id="main-body">
                <!-- Top App Bar -->
                <header class="top-app-bar" id="run-header">
                    <div class="app-bar-content">
                        <button class="nav-toggle tooltip" aria-label="Toggle navigation" data-tooltip="Toggle sidebar">
                            <span class="material-icons">menu</span>
                        </button>
                        <div class="app-bar-title">
                            <h1 id="main-run-title" class="run-title">Select a Run</h1>
                        </div>
                        <div class="app-bar-actions">
                            <button class="icon-button tooltip" id="view-toggle" aria-label="Toggle Graph View" data-tooltip="Switch to Graph View">
                                <span class="material-icons">account_tree</span>
                            </button>
                            <button class="icon-button tooltip" id="refresh-btn" aria-label="Refresh data" data-tooltip="Refresh data" title="Refresh data">
                                <span class="material-icons">refresh</span>
                            </button>
                            <button class="icon-button tooltip" id="settings-btn" aria-label="Settings" data-tooltip="Configuration">
                                <span class="material-icons">settings</span>
                            </button>
                        </div>
                    </div>
                </header>

                <!-- Content Area -->
                <div class="content-area">
                    <div id="black-block" class="spacer-block"></div>

                    <!-- Messages Container -->
                    <div class="messages-container" id="list-view">
                        <main id="messages" class="messages-grid"></main>
                    </div>

                    <!-- Graph Container -->
                    <div class="graph-container" id="graph-view" style="display: none;">
                        <div id="graph-svg"></div>
                        <div id="node-details" class="node-details-panel">
                            <div class="panel-header">
                                <h3>Node Details</h3>
                                <button class="icon-button tooltip" id="close-details" aria-label="Close" data-tooltip="Close">
                                    <span class="material-icons">close</span>
                                </button>
                            </div>
                            <div class="panel-content" id="details-content">
                                <p>Select a node to view details</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Configuration Side Panel -->
        <div id="config-scrim" class="scrim" aria-hidden="true"></div>
        <aside id="config-panel" class="side-panel" aria-hidden="true" aria-labelledby="settings-btn">
            <div class="panel-header">
                <div class="card-title">
                    <span class="material-icons">settings</span>
                    <h3>Configuration</h3>
                </div>
                <button class="icon-button tooltip" id="close-config" aria-label="Close Configuration" data-tooltip="Close">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div class="panel-content">
                <pre id="run-config" class="config-content">No configuration data available</pre>
            </div>
        </aside>
    </body>
    <template id="run-list-entry-template">
        <li class="run-list-entry">
            <a>
                <div class="run-list-info">
                    <h3 class="run-id"></h3>
                    <span class="run-model"></span>
                    <span class="run-tags"></span>
                    <span class="run-state"></span>
                </div>
                <div class="run-list-timing">
                    <span class="run-started-at"></span>
                    <span class="run-stopped-at"></span>
                </div>
            </a>
        </li>
    </template>
    <template id="section-template">
        <div class="section">
            <div class="line start-line"></div>
            <span class="section-name"></span>
            <div class="line end-line"></div>
        </div>
    </template>
    <template id="message-template">
        <details open class="message">
            <summary>
                <header class="message-header">
                    <div>
                        <h3 class="role"></h3>
                        <span class="tokens-query"></span>
                    </div>
                    <div>
                        <span class="duration"></span>
                        <span class="tokens-response"></span>
                    </div>
                </header>
            </summary>
            <pre class="message-text"></pre>
            <div class="tool-calls"></div>
        </details>
    </template>
    <template id="message-tool-call">
        <details open class="tool-call">
            <summary>
                <header class="tool-call-header">
                    <h3 class="tool-call-function"></h3>
                    <span class="tool-call-state"></span>
                    <span class="tool-call-duration"></span>
                </header>
            </summary>
            <pre class="tool-call-parameters binary"></pre>
            <pre class="tool-call-results binary"></pre>
        </details>
    </template>
    <script src="/static/client.js"></script>
    <script src="/static/graph-view.js"></script>
    <script src="/static/md3-enhancements.js"></script>
    <script>
        // Debug script to test UI functionality
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, checking UI elements...');
            
            // Check if view toggle button exists
            const viewToggle = document.getElementById('view-toggle');
            console.log('View toggle button:', viewToggle);
            
            // Check if graph view exists
            const graphView = document.getElementById('graph-view');
            console.log('Graph view container:', graphView);
            
            // Check if graph view object is initialized
            setTimeout(() => {
                console.log('Graph view object:', window.graphView);
                if (window.graphView) {
                    console.log('Graph view nodes:', window.graphView.nodes.length);
                    console.log('Graph view links:', window.graphView.links.length);
                }
            }, 1000);
        });
    </script>
</html>
